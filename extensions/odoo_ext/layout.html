{% extends "basic/layout.html" %}
{% set html5_doctype = True %}

{% block scripts %}
    {{ super() }}
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>
    {# FIXME VFE boostrap beta cdn ??? #}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
        crossorigin="anonymous"></script>
    <script type="text/javascript" src="{{ pathto('_static/js/jquery.noconflict.js', 1) }}"></script>
    <script type="text/javascript" src="{{ pathto('_static/js/menu.js', 1) }}"></script>
    <script type="text/javascript" src="{{ pathto('_static/js/layout.js', 1) }}"></script>
    <script type="text/javascript" src="{{ pathto('_static/js/page_toc.js', 1) }}"></script>
{% endblock %}

{% set classes = [] %}
{% if pagename == master_doc %}
    {% set classes = classes + ['index'] %}
{% endif %}

{% if 'code-column' in meta %}
    {% set classes = classes + ['has_code_col'] %}
{% endif %}

{% if 'classes' in meta %}
    {% set classes = classes + meta['classes'].split() %}
{% endif %}

{%- block linktags -%}
    {% for code, url in language_codes %}
        <link rel="alternate" hreflang="{{ code }}" href="{{ url }}" />
    {%- endfor %}
    <link rel="canonical" href="{{ canonical }}" />
    {{ super() }}
{%- endblock -%}

{#
    Google analytics key logic, to keep
    We do not want to call super here since our custom footer logic is defined in the content block
#}
{%- block footer -%}
    {%- if google_analytics_key -%}
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', '{{ google_analytics_key }}', 'auto');
            ga('set', 'anonymizeIp', true);
            ga('send','pageview');
        </script>
    {%- endif -%}
{%- endblock -%}

{%- block header -%}
    <nav id="o_main_toctree" class="o_side_nav border-end">
        {% include "layout_templates/menu.html" %}
    </nav>
    <header class="o_main_header border-bottom">
        {% include "layout_templates/header.html" %}
    </header>
{%- endblock -%}

{%- block content -%}
    <div id="wrap">
        <main class="{{ ' '.join(classes) }} {% if 'has-toc' in meta %}doc-toc{% endif %}">
            {% if pagename == master_doc %}
                {# Custom landing page on the root of the documentation #}
                {% include "layout_templates/homepage.html" %}
            {% else %}
                <div id="o_content" class="o_content row">
                    <article class="doc-body mb-5 {% if pagename in toc%}index-category{% endif %}">
                        {% block body %} {% endblock %}
                        {# VFE TODO hide the github_link for toctree pages ? #}
                        {% if github_link %}
                            <a href="{{ github_link(mode='edit') }}" class="o_git_link">Edit on GitHub</a>
                        {% endif %}
                    </article>
                </div>
            {% endif %}
            <div id="mask"></div>
        </main>
        {% if 'has-toc' not in meta and not (pagename in toc) %}
            <aside id="o_on_page" class="o_on_page">
                {% include "layout_templates/page_toc.html" %}
            </aside>
        {% endif %}
        <footer>
            {% include "layout_templates/footer.html" %}
        </footer>
    </div>
{%- endblock -%}
